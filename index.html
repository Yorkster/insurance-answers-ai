<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Business Insurance Answers</title>
  <meta name="description" content="Free insurance Q&A tool curated by Brayden York">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; background: #f8fafa; color: #333; line-height: 1.6; }
    header { background: linear-gradient(135deg, #1e40af, #3b82f6); color: white; text-align: center; padding: 80px 20px; }
    h1 { margin: 0; font-size: 3em; }
    h2 { font-size: 1.5em; font-weight: 400; margin: 15px 0 0; }
    .container { max-width: 960px; margin: 40px auto; padding: 20px; }
    .bio-section { display: flex; align-items: center; background: white; border-radius: 16px; padding: 40px; box-shadow: 0 6px 30px rgba(0,0,0,0.1); margin-bottom: 50px; flex-wrap: wrap; }
    .bio-section img { border-radius: 50%; width: 140px; height: 140px; object-fit: cover; margin-right: 40px; border: 4px solid #e0e7ff; }
    .bio-text h3 { margin: 0 0 10px; font-size: 1.8em; color: #1e40af; }
    .chat-box { background: white; border-radius: 16px; padding: 40px; box-shadow: 0 6px 30px rgba(0,0,0,0.1); text-align: center; }
    #chatHistory { max-height: 500px; overflow-y: auto; margin: 20px 0; padding: 15px; background: #f8fafa; border-radius: 12px; border: 1px solid #e0e7ff; text-align: left; }
    .message-pair { margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
    .question-bubble { background: #e0e7ff; color: #1e40af; padding: 12px 18px; border-radius: 18px; display: inline-block; max-width: 80%; }
    .answer-bubble { background: #f0f9ff; padding: 18px 22px; border-radius: 18px; border-left: 5px solid #3b82f6; max-width: 95%; }
    #question { width: 100%; max-width: 760px; padding: 18px; font-size: 1.2em; border: 2px solid #ddd; border-radius: 12px; margin: 25px 0; box-sizing: border-box; }
    button { background: #3b82f6; color: white; border: none; padding: 16px 36px; font-size: 1.3em; border-radius: 12px; cursor: pointer; }
    button:hover { background: #2563eb; }
    #response { margin-top: 20px; min-height: 100px; }
    .thinking-indicator { text-align: center; padding: 30px; color: #3b82f6; }
    .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .cta { margin: 50px 0; text-align: center; }
    .cta a { background: #10b981; color: white; padding: 18px 40px; text-decoration: none; border-radius: 12px; font-weight: bold; font-size: 1.2em; }
    footer { text-align: center; padding: 40px; color: #666; border-top: 1px solid #eee; }
    @media (max-width: 768px) { .bio-section { flex-direction: column; text-align: center; } .bio-section img { margin: 0 0 20px; } }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="icon" href="favicon.ico" type="image/x-icon"> <!-- or /Favicon/favicon.ico if in folder -->
</head>
<body>
  <header>
    <h1>Insurance Answers</h1>
    <h2>Get clear answers to your insurance questions</h2>
    <p><small>This site is for general educational information only and may generate incorrect answers. Consult a licensed professional in your area for personalized advice.</small></p>
  </header>

  <div class="container">
    <div class="bio-section">
      <img src="Brayden image.jfif" alt="Brayden York">
      <div class="bio-text">
        <h3>Brayden York, RIMS-CRMP</h3>
        <p>Commercial Insurance & Risk Management specilaist</p>
        <p>Helping Canadian businesses protect against risk with smart, tailored coverage strategies.</p>
      </div>
    </div>

    <div class="chat-box">
      <h2>Ask me anything about insurance</h2>
      <p style="color:#666; max-width:700px; margin:20px auto;">Examples: "What does a deductible mean?", "How does cyber insurance work?", "What's covered under D&O?"</p>

      <div id="chatHistory" class="chat-history"></div>

      <div id="response"></div>

      <input type="text" id="question" placeholder="Type your insurance question here..." onkeypress="if(event.key==='Enter') getAnswer()">

      <button onclick="getAnswer()">Ask</button>
      <button onclick="clearHistory()" style="margin-left:15px; background:#dc2626; padding:12px 24px;">Clear Chat History</button>

      <div class="cta">
        <a href="mailto:byork@bflcanada.ca?subject=Insurance%20Consultation%20Request">Email Me for a Free Insurance Consultation</a>
      </div>
    </div>
  </div>

  <footer>
    <p>InsuranceAnswers.ca | Curated by Brayden York</p>
    <p><small>This site is for general educational information only — consult a licensed professional in your area for personalized advice.</small></p>
  </footer>

  <script>
    window.onload = loadChatHistory;

    function loadChatHistory() {
      const history = JSON.parse(localStorage.getItem('insuranceChatHistory') || '[]');
      const chatHistoryDiv = document.getElementById('chatHistory');
      chatHistoryDiv.innerHTML = '';
      history.forEach(pair => {
        const div = document.createElement('div');
        div.className = 'message-pair';
        div.innerHTML = `<div class="question-bubble"><strong>You:</strong> ${pair.question}</div><div class="answer-bubble">${pair.answer.replace(/\n/g, '<br>')}</div>`;
        chatHistoryDiv.appendChild(div);
      });
      chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
    }

    function saveChatHistory(question, answer) {
      const history = JSON.parse(localStorage.getItem('insuranceChatHistory') || '[]');
      history.push({ question, answer });
      if (history.length > 10) history.shift();
      localStorage.setItem('insuranceChatHistory', JSON.stringify(history));
    }
function clearHistory() {
  if (confirm('Clear all chat history? This cannot be undone.')) {
    localStorage.removeItem('insuranceChatHistory');
    document.getElementById('chatHistory').innerHTML = '';
    document.getElementById('response').innerHTML = '';
  }
}
    async function getAnswer() {
      const input = document.getElementById('question');
      const question = input.value.trim();
      const responseDiv = document.getElementById('response');
      if (!question) {
        responseDiv.innerHTML = "<p style='color:red;'>Please enter a question!</p>";
        return;
      }

      responseDiv.innerHTML = `
        <div class="thinking-indicator">
          <div class="spinner"></div>
          <p><strong>Thinking...</strong> Analyzing as an insurance specialist...<br>(20–40 seconds for detailed answers)</p>
        </div>
      `;

      input.value = '';

      try {
        const res = await fetch('/api/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question })
        });

        const data = await res.json();
        if (!res.ok) throw new Error(data.error || 'Error');

        const formatted = data.answer.replace(/\n/g, '<br>');
        responseDiv.innerHTML = `<div class="answer-bubble">${formatted}</div>`;

        saveChatHistory(question, data.answer);
        loadChatHistory();
        responseDiv.scrollIntoView({ behavior: 'smooth' });
      } catch (err) {
        responseDiv.innerHTML = `<p style='color:red;'>Error: ${err.message}. Try again.</p>`;
      }
    }
  </script>
</body>
</html>
